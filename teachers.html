<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Teachers — Teacher Chat Demo</title>
  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --accent: #3b82f6;
      --muted: #6b7280;
      --sent: #dcfce7;
      --recv: #eef2ff;
    }
    * { box-sizing: border-box; font-family: Inter, system-ui, Arial; }
    body { margin:0; min-height:100vh; background:var(--bg); }
    header {
      background:linear-gradient(90deg,#eef2ff,#fff); padding:14px 20px; display:flex;
      align-items:center; justify-content:space-between; box-shadow: 0 1px 0 rgba(0,0,0,0.04);
    }
    .brand { font-weight:700; color:#0f172a; }
    .user { color:var(--muted); font-size:14px; }
    .container { max-width:1000px; margin:22px auto; padding:0 20px; display:grid; gap:18px;
      grid-template-columns: 320px 1fr;
    }
    /* left column */
    .panel { background:var(--card); border-radius:12px; padding:16px; box-shadow:0 6px 20px rgba(15,23,42,0.06); }
    select { width:100%; padding:8px 10px; margin-bottom:12px; border-radius:8px; border:1px solid #e6e6e6; }
    .profile { display:flex; gap:12px; align-items:center; margin-top:8px; }
    .avatar {
      width:72px; height:72px; border-radius:50%; display:flex; align-items:center; justify-content:center;
      color:#fff; font-weight:700; font-size:20px;
    }
    .profile .meta { line-height:1.2; }
    .profile .meta h3 { margin:0; font-size:16px; color:#111827; }
    .profile .meta p { margin:4px 0 0; color:var(--muted); font-size:13px; }

    /* right column (chat) */
    .chat-window { display:flex; flex-direction:column; height:520px; }
    .messages { flex:1; overflow:auto; padding:18px; }
    .message { max-width:70%; margin-bottom:12px; display:inline-block; clear:both; }
    .message .bubble { padding:10px 12px; border-radius:12px; font-size:14px; line-height:1.3; }
    .message.student { float:right; text-align:right; }
    .message.student .bubble { background:var(--sent); border-bottom-right-radius:4px; }
    .message.teacher { float:left; text-align:left; }
    .message.teacher .bubble { background:var(--recv); border-bottom-left-radius:4px; }
    .time { display:block; font-size:11px; color:var(--muted); margin-top:4px; }

    .composer { padding:12px; border-top:1px solid #eef2f6; display:flex; gap:8px; align-items:center; background:var(--card); border-radius:0 0 12px 12px; }
    textarea { flex:1; min-height:46px; max-height:140px; resize:vertical; padding:8px 10px; border-radius:8px; border:1px solid #e6e6e6; font-size:14px; }
    button.send { padding:10px 14px; border-radius:8px; background:var(--accent); color:white; border:0; cursor:pointer; }
    .controls { margin-top:12px; display:flex; gap:8px; }
    .btn { padding:8px 10px; border-radius:8px; border:1px solid #e6e6e6; background:white; cursor:pointer; font-size:14px; }
    .small { font-size:13px; color:var(--muted); margin-top:8px; }

    /* responsive */
    @media (max-width:880px) {
      .container { grid-template-columns: 1fr; }
      .panel { order:2; }
      .chat-window { order:1; height:60vh; }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">Teacher Chat (Demo)</div>
    <div>
      <span class="user" id="userEmail">Welcome</span>
      <button id="logoutBtn" class="btn" style="margin-left:12px;">Logout</button>
    </div>
  </header>

  <div class="container">
    <!-- LEFT: teacher selector & profile -->
    <div class="panel">
      <label for="teacherSelect"><strong>Select a teacher</strong></label>
      <select id="teacherSelect"></select>

      <div class="profile" id="profileCard" style="display:none;">
        <div class="avatar" id="avatarEl">T</div>
        <div class="meta">
          <h3 id="teacherName">Teacher</h3>
          <p id="teacherSubject">Subject</p>
          <p id="teacherBio" class="small"></p>
        </div>
      </div>

      <div class="small" style="margin-top:12px;">
        This is a static demo — messages are stored only in your browser (LocalStorage).
      </div>
    </div>

    <!-- RIGHT: chat -->
    <div class="panel chat-window">
      <div class="messages" id="messages"></div>

      <div class="composer">
        <textarea id="messageInput" placeholder="Write your message... (press Enter to send, Shift+Enter for newline)"></textarea>
        <button class="send" id="sendBtn">Send</button>
      </div>

      <div style="padding:8px 12px;">
        <div class="controls">
          <button id="clearBtn" class="btn">Clear chat</button>
          <button id="refreshBtn" class="btn">Refresh</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /********************
     * Simple static demo chat
     * - No server
     * - Login is fake (saved from login.html)
     * - Chats saved to localStorage under keys like "chat_t1"
     ********************/

    // sample teacher data
    const teachers = [
      { id: 't1', name: 'Mr. Sharma', subject: 'Mathematics', bio: 'I love algebra and problem solving. Ask anything about homework or practice tips.', color:'#f97316' },
      { id: 't2', name: 'Ms. Iyer', subject: 'Science', bio: 'Chemistry and Physics enthusiast. I enjoy experiments and explaining concepts simply.', color:'#10b981' },
      { id: 't3', name: 'Mrs. Khan', subject: 'English', bio: 'Poems, stories and grammar — let\'s make language fun!', color:'#7c3aed' }
    ];

    // helpers
    const el = id => document.getElementById(id);
    const escapeHtml = (s) => s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    const formatTime = (iso) => {
      const d = new Date(iso);
      return d.toLocaleString();
    };

    // check login
    const user = localStorage.getItem('chat_demo_user');
    const loggedIn = localStorage.getItem('chat_demo_logged_in') === '1';
    if (!loggedIn) {
      // not logged in: redirect to login
      window.location.href = 'login.html';
    } else {
      el('userEmail').textContent = 'Logged in as: ' + (user || 'guest');
    }

    // populate select
    const teacherSelect = el('teacherSelect');
    teachers.forEach(t => {
      const opt = document.createElement('option');
      opt.value = t.id;
      opt.textContent = t.name + ' — ' + t.subject;
      teacherSelect.appendChild(opt);
    });

    // UI elements
    const profileCard = el('profileCard');
    const avatarEl = el('avatarEl');
    const teacherNameEl = el('teacherName');
    const teacherSubjectEl = el('teacherSubject');
    const teacherBioEl = el('teacherBio');
    const messagesEl = el('messages');
    const inputEl = el('messageInput');

    let currentTeacherId = teacherSelect.value;
    let messages = []; // loaded for current teacher

    // localStorage helpers
    function saveMessagesFor(id, arr) {
      localStorage.setItem('chat_' + id, JSON.stringify(arr));
    }
    function loadMessagesFor(id) {
      return JSON.parse(localStorage.getItem('chat_' + id) || '[]');
    }

    // render profile
    function showProfile(t) {
      profileCard.style.display = 'flex';
      teacherNameEl.textContent = t.name;
      teacherSubjectEl.textContent = t.subject;
      teacherBioEl.textContent = t.bio;
      // avatar initials
      const initials = t.name.split(' ').map(x => x[0]).slice(0,2).join('').toUpperCase();
      avatarEl.textContent = initials;
      avatarEl.style.background = t.color;
    }

    // render messages
    function renderMessages() {
      messagesEl.innerHTML = '';
      if (!messages.length) {
        messagesEl.innerHTML = '<div class="small" style="color:var(--muted); padding:6px 0;">No messages yet. Send the first message!</div>';
        return;
      }
      messages.forEach(m => {
        const wrap = document.createElement('div');
        wrap.className = 'message ' + (m.sender === 'student' ? 'student' : 'teacher');

        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.innerHTML = escapeHtml(m.text);

        const time = document.createElement('div');
        time.className = 'time';
        time.textContent = formatTime(m.time);

        wrap.appendChild(bubble);
        wrap.appendChild(time);
        messagesEl.appendChild(wrap);
      });
      // scroll to bottom
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // when teacher selection changes
    function onTeacherChange() {
      currentTeacherId = teacherSelect.value;
      const t = teachers.find(x => x.id === currentTeacherId);
      showProfile(t);
      messages = loadMessagesFor(currentTeacherId);
      renderMessages();
    }

    // send message (student)
    function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;
      const msg = { sender: 'student', text: text, time: new Date().toISOString() };
      messages.push(msg);
      saveMessagesFor(currentTeacherId, messages);
      inputEl.value = '';
      renderMessages();

      // simulate a teacher reply after a short delay (static demo)
      setTimeout(() => {
        const teacher = teachers.find(x => x.id === currentTeacherId);
        const replyText = `Hi — I received your message. I'll reply properly soon. (This is an automatic demo reply from ${teacher.name})`;
        const reply = { sender: 'teacher', text: replyText, time: new Date().toISOString() };
        messages.push(reply);
        saveMessagesFor(currentTeacherId, messages);
        renderMessages();
      }, 900);
    }

    // wire events
    teacherSelect.addEventListener('change', onTeacherChange);
    el('sendBtn').addEventListener('click', sendMessage);
    el('clearBtn').addEventListener('click', function () {
      if (confirm('Clear chat with this teacher?')) {
        messages = [];
        localStorage.removeItem('chat_' + currentTeacherId);
        renderMessages();
      }
    });
    el('refreshBtn').addEventListener('click', function () {
      messages = loadMessagesFor(currentTeacherId);
      renderMessages();
    });
    el('logoutBtn').addEventListener('click', function () {
      localStorage.removeItem('chat_demo_logged_in');
      localStorage.removeItem('chat_demo_user');
      // optional: do NOT clear chat entries so user can log back in and see them
      window.location.href = 'login.html';
    });

    // send with Enter (Shift+Enter for newline)
    inputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // initial load
    onTeacherChange();
  </script>
</body>
</html>
